<!DOCTYPE>

<html>
  <head>
    <script type="text/javascript" src="js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="js/lib/phaser.min.js"></script>
  </head>

  <script type="text/javascript">
    Game = {};

    Game.Load = function(game){};

    Game.Load.prototype = {
      
      preload: function(){
        game.load.image('star', 'assets/star.png');
        game.load.image('mushroom', 'assets/mushroom.png');
      },

      create: function(){
        this.loadText = game.add.text(200, 200, "move with arrow keys\n press UP to begin", { font: "20px arial", fill: "#fff" });
        this.cursors = game.input.keyboard.createCursorKeys();
        this.time = this.game.time.now + 1000;
      },

      update: function(){
        if (this.game.time.now > this.time && this.cursors.up.isDown) {
        game.state.start('Play');
        }
      }
    };

    Game.Play = function(game){};

    Game.Play.prototype = {

      create: function(){
        // Player
        this.player = game.add.sprite((game.world.width / 2) - 12, (game.world.height / 2) - 11, 'star');
        game.physics.enable(this.player, Phaser.Physics.ARCADE);
        this.player.body.collideWorldBounds = true;

        // Baddies
        this.baddies = game.add.group();

        // Add one baddy every second
        game.time.events.loop(Phaser.Timer.SECOND * 0.5, function(){
            var startX, startY, angle;
            if (_.random(0, 1) === 0) {
            startX = _.random(0, 400);
            startY = _.random(0, 1) === 0 ? -25 : 425;
            } else {
            startY = _.random(0, 400);
            startX = _.random(0, 1) === 0 ? -26 : 426;
            }

            if (startX <= 200 && startY <= 200) {
            angle = _.random(20, 70);
            } else if ( startX > 200 && startY <= 200 ) {
            angle = _.random(110, 160);
            } else if ( startX > 200 && startY >= 200 ) {
            angle = _.random(200, 250);
            } else {
            angle = _.random(290, 340);
            }

            var baddy = this.baddies.create(startX, startY, 'mushroom');
            game.physics.enable(baddy, Phaser.Physics.ARCADE);
            game.physics.arcade.velocityFromAngle(angle, 150, baddy.body.velocity);
        }, this);

        // Cursors
        this.cursors = game.input.keyboard.createCursorKeys();

        // Scoretext
        this.score = 0;
        this.scoreText = game.add.text(15, 10, this.score, {font: '20px arial', fill: '#fff'});
      },

      update: function(){
        game.physics.arcade.overlap(this.player, this.baddies, this.killPlayer, null, this);

        // Player
        this.player.body.velocity.x = 0;
        this.player.body.velocity.y = 0;

        // Add cursor control of player
        if (this.cursors.left.isDown) {
          this.player.body.velocity.x = -150;
        } else if (this.cursors.right.isDown){
          this.player.body.velocity.x = 150;
        } else if (this.cursors.up.isDown){
          this.player.body.velocity.y = -150;
        } else if (this.cursors.down.isDown){
          this.player.body.velocity.y = 150;
        }
      },

      killPlayer: function(player, baddy){
        player.kill();
      }

    };

    Game.Over = function(game){};

    Game.Over.prototype = {
    };

    var game = new Phaser.Game(400, 400, Phaser.AUTO, '');

    game.state.add('Load', Game.Load);
    game.state.add('Play', Game.Play);
    game.state.add('Over', Game.Over);
    game.state.start('Load');

  </script>

  <body>
  </body>
</html>


