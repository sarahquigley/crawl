<!DOCTYPE>

<html>
  <head>
    <script type="text/javascript" src="js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="js/lib/phaser.min.js"></script>
  </head>

  <script type="text/javascript">
    var game = new Phaser.Game(400, 400, Phaser.AUTO, '', { preload: preload, create: create, update: update });

    var player, baddies, cursors, score, scoreText;

    function preload(){
      game.load.image('star', 'assets/star.png');
      game.load.image('mushroom', 'assets/mushroom.png');
    }

    function create(){
      // Player
      player = game.add.sprite((game.world.width / 2) - 12, (game.world.height / 2) - 11, 'star');
      game.physics.enable(player, Phaser.Physics.ARCADE);
      player.body.collideWorldBounds = true;

      // Baddies
      baddies = game.add.group();

      // Add one baddy every second
      game.time.events.loop(Phaser.Timer.SECOND * 0.5, function(i){
          var startX, startY, angle;
          if (_.random(0, 1) === 0) {
            startX = _.random(0, 400);
            startY = _.random(0, 1) === 0 ? -25 : 425;
          } else {
            startY = _.random(0, 400);
            startX = _.random(0, 1) === 0 ? -26 : 426;
          }

          if (startX <= 200 && startY <= 200) {
            angle = _.random(20, 70);
          } else if ( startX > 200 && startY <= 200 ) {
            angle = _.random(110, 160);
          } else if ( startX > 200 && startY >= 200 ) {
            angle = _.random(200, 250);
          } else {
            angle = _.random(290, 340);
          }

          var baddy = baddies.create(startX, startY, 'mushroom');
          game.physics.enable(baddy, Phaser.Physics.ARCADE);
          game.physics.arcade.velocityFromAngle(angle, 150, baddy.body.velocity);
      }, this);

      // Cursors
      cursors = game.input.keyboard.createCursorKeys();
    }

    function update(){
      game.physics.arcade.overlap(player, baddies, killPlayer, null, this);

      // Player
      player.body.velocity.x = 0;
      player.body.velocity.y = 0;

      // Add cursor control of player
      if (cursors.left.isDown) {
        player.body.velocity.x = -150;
      } else if (cursors.right.isDown){
        player.body.velocity.x = 150;
      } else if (cursors.up.isDown){
        player.body.velocity.y = -150;
      } else if (cursors.down.isDown){
        player.body.velocity.y = 150;
      }
    }

    function killPlayer(player, baddy){
      player.kill();
    }

  </script>

  <body>
  </body>
</html>


