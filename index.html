<!DOCTYPE>

<html>
  <head>
    <script type="text/javascript" src="js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="js/lib/phaser.min.js"></script>

    <style>
      #content{
        margin: auto;
        text-align: center;
        width: 400px;
      }
    </style>
  </head>

  <script type="text/javascript">
    Game = {};

    Game.Load = function(game){};

    Game.Load.prototype = {
      
      preload: function(){
        game.load.image('player', 'assets/ladybug-shadow-60.png');
        game.load.spritesheet('baddy', 'assets/ant-spritesheet-shadow-30.png', 32, 30);
        game.load.image('background', 'assets/background.jpg');
      },

      create: function(){
        this.text = game.add.text(game.world.centerX, game.world.centerY, "move with arrow keys\npress UP to begin", { font: "20px arial", fill: "#fff" });
        this.text.anchor.setTo(0.5);
        this.cursors = game.input.keyboard.createCursorKeys();
        this.time = this.game.time.now + 1000;
      },

      update: function(){
        if (this.game.time.now > this.time && this.cursors.up.isDown) {
        game.state.start('Play');
        }
      }
    };

    Game.Play = function(game){};

    Game.Play.prototype = {

      create: function(){
        this.background = game.add.tileSprite(0, 0, 400, 400, 'background');

        // Player
        this.player = game.add.sprite((game.world.width / 2) - 12, (game.world.height / 2) - 11, 'player');
        game.physics.enable(this.player, Phaser.Physics.ARCADE);
        this.player.body.collideWorldBounds = true;
        //this.player.body.setSize(50, 38, -5, -5);  

        // Baddies
        this.baddies = game.add.group();
        this.baddies.setAll('outOfBoundsKill', true);
        this.nextBaddyTime = game.time.now;

        // Cursors
        this.cursors = game.input.keyboard.createCursorKeys();

        // Scoretext
        this.score = 0;
        this.nextScoringTime = game.time.now;
        this.scoreText = game.add.text(15, 10, this.score.toString(), {font: '20px arial', fill: '#fff'});
      },

      update: function(){
        game.physics.arcade.overlap(this.player, this.baddies, this.killPlayer, null, this);

        // Player
        this.player.body.velocity.x = 0;
        this.player.body.velocity.y = 0;
        this.player.body.angularVelocity = 0;

        if (game.input.keyboard.isDown(Phaser.Keyboard.LEFT)) {
          this.player.body.angularVelocity = -200;
        } else if (game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)) {
          this.player.body.angularVelocity = 200;
        }

        if (game.input.keyboard.isDown(Phaser.Keyboard.UP)) {
          game.physics.arcade.velocityFromAngle(this.player.angle, 300, this.player.body.velocity);
        }

        if (game.input.keyboard.isDown(Phaser.Keyboard.DOWN)) {
          game.physics.arcade.velocityFromAngle(this.player.angle, -300, this.player.body.velocity);
        }

        // Spawn baddies
        if(game.time.now >= this.nextBaddyTime){
          this.nextBaddyTime += 500;
          this.newBaddy();
        }

        // Increase score
        if(game.time.now >= this.nextScoringTime){
          this.nextScoringTime += 1000;
          this.score += 1;
          this.scoreText.text = this.score.toString();
        }
      },

      newBaddy: function(){
        var startX, startY, angle;
        if (_.random(0, 1) === 0) {
        startX = game.world.randomX;
        startY = _.random(0, 1) === 0 ? -25 : 425;
        } else {
        startY = game.world.randomY;
        startX = _.random(0, 1) === 0 ? -26 : 426;
        }

        if (startX <= 200 && startY <= 200) {
        angle = _.random(20, 70);
        } else if ( startX > 200 && startY <= 200 ) {
        angle = _.random(110, 160);
        } else if ( startX > 200 && startY >= 200 ) {
        angle = _.random(200, 250);
        } else {
        angle = _.random(290, 340);
        }

        var baddy = this.baddies.create(startX, startY, 'baddy');
        game.physics.enable(baddy, Phaser.Physics.ARCADE);
        baddy.body.rotation = angle;
        //this.player.body.setSize(50, 38, -5, -5);  
        baddy.animations.add('move', [0, 1, 2], 10, true);
        baddy.animations.play('move');
        game.physics.arcade.velocityFromAngle(angle, 150, baddy.body.velocity);
      },

      killPlayer: function(player, baddy){
        player.kill();
        game.score = this.score;
        game.state.start('Over');
      }

    };

    Game.Over = function(game){};

    Game.Over.prototype = {
      create: function(){
        this.text = game.add.text(game.world.centerX, game.world.centerY, "game over\nscore: " + game.score + "\npress UP to restart", { font: "20px arial", fill: "#fff" });
        this.text.anchor.setTo(0.5);
        this.cursors = game.input.keyboard.createCursorKeys();
        this.time = this.game.time.now + 1000;
      },

      update: function(){
        if (this.game.time.now > this.time && this.cursors.up.isDown) {
        game.state.start('Play');
        }
      }
    };

    var game = new Phaser.Game(400, 400, Phaser.AUTO, 'game');

    game.state.add('Load', Game.Load);
    game.state.add('Play', Game.Play);
    game.state.add('Over', Game.Over);
    game.state.start('Load');

  </script>

  <body>

    <div id="content">

      <h1>Run</h1>

      <div id="game"></div>

    </div>

  </body>

</html>


